name: Build Cryptidium Browser

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup MSBuild
      uses: microsoft/setup-msbuild@v2
      
    - name: Setup Windows 11 SDK
      uses: GuillaumeFalourd/setup-windows10-sdk-action@v2
      with:
        sdk-version: 22621
        
    - name: Clone WebKit
      run: git clone https://github.com/Cryptidium/WebKit.git
      
    - name: Build Solution (Release)
      run: msbuild Cryptidium.sln /p:Configuration=Release /p:Platform=x64 /p:WindowsTargetPlatformVersion=10.0.22621.0
      
    - name: Upload Build Artifact
      uses: actions/upload-artifact@v4
      with:
        name: Cryptidium-Browser-Release
        path: |
          x64/Release/Cryptidium.exe
          x64/Release/*.dll
          x64/Release/Assets/
          x64/Release/WebKit/
        if-no-files-found: error
