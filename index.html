<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cryptidium UI</title>
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Fluent UI Web Components -->
    <script type="module">
        import {
            provideFluentDesignSystem,
            fluentTabs,
            fluentTab,
            fluentButton,
            fluentTextField
        } from "https://unpkg.com/@fluentui/web-components/dist/web-components.min.js";
        provideFluentDesignSystem().register(
            fluentTabs(),
            fluentTab(),
            fluentButton(),
            fluentTextField()
        );
    </script>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            font-family: 'Segoe UI', sans-serif;
        }
        .window {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .title-bar {
            display: flex;
            align-items: center;
            height: 32px;
            padding: 0 4px;
            background-color: var(--neutral-layer-1);
            -webkit-app-region: drag;
        }
        .title-bar fluent-tabs {
            flex: 1;
            -webkit-app-region: no-drag;
        }
        .title-bar fluent-button {
            -webkit-app-region: no-drag;
            margin-left: 4px;
        }
        fluent-tab .close {
            margin-left: 8px;
            cursor: pointer;
        }
        .nav-bar {
            display: flex;
            align-items: center;
            height: 40px;
            padding: 0 4px;
            background: var(--neutral-layer-2);
        }
        .nav-bar fluent-button {
            margin-right: 4px;
        }
        .nav-bar fluent-text-field {
            flex: 1;
            margin-right: 4px;
        }
        .content {
            flex: 1;
            position: relative;
        }
        .content iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script>
        const { useState } = React;

        function BrowserApp() {
            const [tabs, setTabs] = useState([{ id: 1, url: 'https://google.com' }]);
            const [currentId, setCurrentId] = useState(1);
            const [urlInput, setUrlInput] = useState('https://google.com');

            const addTab = () => {
                const nextId = tabs.length ? Math.max(...tabs.map(t => t.id)) + 1 : 1;
                const newTab = { id: nextId, url: 'https://google.com' };
                setTabs([...tabs, newTab]);
                setCurrentId(nextId);
                setUrlInput(newTab.url);
            };

            const closeTab = (id) => {
                let newTabs = tabs.filter(t => t.id !== id);
                if (newTabs.length === 0) {
                    newTabs = [{ id: 1, url: 'https://google.com' }];
                }
                setTabs(newTabs);
                if (currentId === id) {
                    setCurrentId(newTabs[0].id);
                    setUrlInput(newTabs[0].url);
                }
            };

            const selectTab = (id) => {
                setCurrentId(id);
                const t = tabs.find(t => t.id === id);
                if (t) setUrlInput(t.url);
            };

            const navigate = () => {
                setTabs(tabs.map(t => {
                    if (t.id === currentId) {
                        return { ...t, url: urlInput };
                    }
                    return t;
                }));
            };

            const onKeyDown = (e) => {
                if (e.key === 'Enter') {
                    navigate();
                }
            };

            return (
                React.createElement('div', { className: 'window' },
                    React.createElement('div', { className: 'title-bar' },
                        React.createElement('fluent-tabs', {
                            activeid: String(currentId),
                            onChange: (e) => selectTab(parseInt(e.currentTarget.activeid))
                        },
                            tabs.map(tab =>
                                React.createElement('fluent-tab', {
                                    id: String(tab.id),
                                    key: tab.id
                                },
                                    `Tab ${tab.id}`,
                                    React.createElement('span', {
                                        className: 'close',
                                        onClick: (ev) => { ev.stopPropagation(); closeTab(tab.id); }
                                    }, '×')
                                )
                            )
                        ),
                        React.createElement('fluent-button', { appearance: 'stealth', onClick: addTab }, '+')
                    ),
                    React.createElement('div', { className: 'nav-bar' },
                        React.createElement('fluent-button', { appearance: 'accent', onClick: () => { /* back placeholder */ } }, '<'),
                        React.createElement('fluent-button', { appearance: 'accent', onClick: () => { /* forward placeholder */ } }, '>'),
                        React.createElement('fluent-button', { appearance: 'accent', onClick: () => { /* refresh */ } }, '⟳'),
                        React.createElement('fluent-text-field', {
                            value: urlInput,
                            onInput: (e) => setUrlInput(e.target.value),
                            onKeyDown: onKeyDown
                        }),
                        React.createElement('fluent-button', { appearance: 'accent', onClick: navigate }, 'Go')
                    ),
                    React.createElement('div', { className: 'content' },
                        tabs.map(tab =>
                            tab.id === currentId
                                ? React.createElement('iframe', { key: tab.id, src: tab.url, sandbox: '' })
                                : null
                        )
                    )
                )
            );
        }

          const root = ReactDOM.createRoot(document.getElementById('root'));
          root.render(React.createElement(BrowserApp));
      </script>
  </body>
  </html>
